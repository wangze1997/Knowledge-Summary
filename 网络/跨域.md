# 跨域

### 同源策略

同源策略是浏览器的一个安全功能，不同源的客户端脚本在没有授权的情况下，不能去对方的服务器获取资源。同源是指协议、域名、还有端口都相同。

```
http://a.xyz.com/dir/page.html 同源检测的示例:
http://a.xyz.com/dir2/other.html 成功
https://a.xyz.com/secure.html 失败 协议不同
http://a.xyz.com:81/dir/etc.html 失败 端口不同
http://a.opq.com/dir/other.html 失败 域名不同
www是2级域名的前缀，属于特殊的3级域名,国外为了方便看，已经不使用了。
```

不同源的限制

- ajax请求无法发送。
- cookie无法取得，因为可以设置2个页面可以共享cookie，不同源的话你不能使用对方cookie。
- dom元素无法获取，典型的就是iframe父子域的问题，父域无法获取子域dom元素。

## 常见的跨域方式

### JSONP跨域（GET）

利用img、iframe、script的src属性不受浏览器同源策略的限制可以完成跨域操作。

- 动态创建script标签，src属性就是请求地址，地址上添加回调，告诉后台要执行的函数。
- 将script标签插入dom中，加载完后会执行。
- 通常是返回文本，但是在script标签中所以会立即执行
- 把执行的函数保存到window对象上,否则找不到

### CORS跨域资源共享



### WebSocket跨域

WebSocket是一种通信协议，使用`ws://`（非加密）和`wss://`（加密）作为协议前缀。该协议不实行同源政策，只要服务器支持，就可以通过它进行跨源通信。只需要和服务器进行一次握手，就可以建立连接。

```javascript
let ws = new WebSocket("ws://localhost:9998/echo");
ws.onopen = function(){
      // Web Socket 已连接上，使用 send() 方法发送数据
      console.log("发送数据");
};
ws.onmessage = function (evt) { 
      // 客户端收到数据时触发
      var received_msg = evt.data;
      console.log("数据已接收...");
};
ws.onclose = function(){ 
      // 关闭 websocket时触发
      console.log("连接已关闭..."); 
};

```

### 服务器代理中转